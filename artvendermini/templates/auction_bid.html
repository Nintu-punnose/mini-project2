{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/auction_bid.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <title>{{auction_details.name}}_details</title>
</head>
<body>
    <div id="head_details">
        <div id="web_name">
            ArtVendor
        </div>
        <div id="link">
            <a href="{% url 'index' %}">Home</a>
            <a href="{% url 'images' %}">Art</a>
            <a href="{% url 'Artist' %}">Artist</a>
            <a href="{% url 'index' %}">Our services</a>
            <a href="{% url 'cart' %}">Cart</a>
            {% if request.user.is_authenticated %}
                <span style="color:red">{{ request.user.username }}</span>
                <a href="{% url 'logout_view' %}" >Logout</a>
            {% else %}
                <a href="{% url 'login' %}">Login</a>
            {% endif %}
        </div>
    </div><br><br><br>
 
    <div id="detail_img_body">
        <div id="select_image">
            <div id="magnifier"></div>
            <img src="{{auction_details.image.url}}" alt="" id="img">
        </div>
        <div id="select_details"><br>
            <form action="" method="post">
            {% csrf_token %}
            <p id="details" name="id"><strong>Art Id:</strong> {{auction_details.id}}</p>
            <p id="details" name="name"><strong>Art Name:</strong> {{auction_details.name}}</p>
            <p id="details" name="name"><strong>Seller:</strong> {{auction_details.user.username}}</p>    
            <p id="details" name="starting_bid"><strong>Starting Bid:</strong>{{auction_details.price_range_min}}</p>
            <p id="details" name="ending_bid"><strong>Description:</strong> {{auction_details.description}}</p>
            <p id="details" name="start_date"><strong>Start Date</strong> {{auction_details.start_date}}</p>
            <p id="details" name="end_date"><strong>End Date</strong> {{auction_details.end_date}}</p><br>
            <input type="text" id="bid-price" name="bid_price" placeholder="Enter Price to bid" required style="width: 300px;margin-left:30px"><br><br>
            <p id="details" style="background-color:rgb(163, 197, 11); width:240px;border-radius:5px;color:red" name="latest_price"><strong>Latest Bid:</strong>  {{ highest_bid|default:"No bids yet" }}</p><br><br>
            
            <button type="submit" id="cart_btn" style="background-color: green" onclick="showBidForm()">Submit a bid</button><br>
            </form>
           
    </div>  
    <script>
        // Function to make AJAX request and update content
        function refreshPage() {
            var auctionId = "{{ auction_details.id }}";
            var url = '/auction_bid_ajax/' + auctionId + '/';
            
            $.ajax({
                url: "{% url 'auction_bid' auction_details.id %}",
                type: 'GET',
                success: function(data) {
                    console.log(data)
                    // Update the content with the new highest bid value
                    $('#details[name="latest_price"]').html('<strong>Latest Bid:</strong> ' + (data.highest_bid || 'No bids yet'));
                }
            });
        }
    
        // Auto-refresh every 5 seconds (5000 milliseconds)
        setInterval(refreshPage, 1000);
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var startingBid = parseFloat("{{ auction_details.price_range_min }}");
    
            document.getElementById("bid-price").addEventListener("input", function() {
                var bidPrice = parseFloat(this.value);
    
                // Check if the entered bid is greater than the starting bid
                if (bidPrice <= startingBid) {
                    this.setCustomValidity("Bid must be greater than the starting bid");
                } else {
                    this.setCustomValidity("");
                }
            });
        });
    
        function showBidForm() {
            // Your existing showBidForm() function logic, if any
        }
    </script>
</body>
</html>
